{
    "sourceFile": "components/admin/AdminCategories.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1741337544290,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1741337561461,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n import { useState, useEffect } from \"react\";\r\n import { Button, Input, Card, CardContent } from \"../ui\";\r\n import axios from \"axios\";\r\n-import { renderCategories, handleCategoryChange, getAllChildIds } from \"../../services/categoryService\";\r\n+import { renderCategories, handleCategoryChange, getAllChildIds } from \"../services/categoryService\";\r\n import { ToastContainer, toast } from \"react-toastify\";\r\n import \"react-toastify/dist/ReactToastify.css\";\r\n import { AiFillDelete } from \"react-icons/ai\";\r\n \r\n"
                },
                {
                    "date": 1741337709857,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n import { useState, useEffect } from \"react\";\r\n import { Button, Input, Card, CardContent } from \"../ui\";\r\n import axios from \"axios\";\r\n-import { renderCategories, handleCategoryChange, getAllChildIds } from \"../services/categoryService\";\r\n+import { renderCategories, handleCategoryChange, getAllChildIds } from \"../components/\";\r\n import { ToastContainer, toast } from \"react-toastify\";\r\n import \"react-toastify/dist/ReactToastify.css\";\r\n import { AiFillDelete } from \"react-icons/ai\";\r\n \r\n"
                },
                {
                    "date": 1741337723869,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n import { useState, useEffect } from \"react\";\r\n import { Button, Input, Card, CardContent } from \"../ui\";\r\n import axios from \"axios\";\r\n-import { renderCategories, handleCategoryChange, getAllChildIds } from \"../components/\";\r\n+import { renderCategories, handleCategoryChange, getAllChildIds } from \"../../services/categoryService\";\r\n import { ToastContainer, toast } from \"react-toastify\";\r\n import \"react-toastify/dist/ReactToastify.css\";\r\n import { AiFillDelete } from \"react-icons/ai\";\r\n \r\n"
                },
                {
                    "date": 1741337845938,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,17 +1,17 @@\n import { useState, useEffect } from \"react\";\r\n import { Button, Input, Card, CardContent } from \"../ui\";\r\n import axios from \"axios\";\r\n-import { renderCategories, handleCategoryChange, getAllChildIds } from \"../../services/categoryService\";\r\n+import {getAllChildIds } from \"../../services/categoryService\";\r\n import { ToastContainer, toast } from \"react-toastify\";\r\n import \"react-toastify/dist/ReactToastify.css\";\r\n import { AiFillDelete } from \"react-icons/ai\";\r\n \r\n export default function CategoryManagement() {\r\n   const [categories, setCategories] = useState([]);\r\n   const [form, setForm] = useState({ name: \"\", parent: null });\r\n   const [editingCategory, setEditingCategory] = useState(null);\r\n-  const [formData, setFormData] = useState({ categories: [] });\r\n+  const [setFormData] = useState({ categories: [] });\r\n \r\n   useEffect(() => {\r\n     fetchCategories();\r\n   }, []);\r\n"
                }
            ],
            "date": 1741337544290,
            "name": "Commit-0",
            "content": "import { useState, useEffect } from \"react\";\r\nimport { Button, Input, Card, CardContent } from \"../ui\";\r\nimport axios from \"axios\";\r\nimport { renderCategories, handleCategoryChange, getAllChildIds } from \"../../services/categoryService\";\r\nimport { ToastContainer, toast } from \"react-toastify\";\r\nimport \"react-toastify/dist/ReactToastify.css\";\r\nimport { AiFillDelete } from \"react-icons/ai\";\r\n\r\nexport default function CategoryManagement() {\r\n  const [categories, setCategories] = useState([]);\r\n  const [form, setForm] = useState({ name: \"\", parent: null });\r\n  const [editingCategory, setEditingCategory] = useState(null);\r\n  const [formData, setFormData] = useState({ categories: [] });\r\n\r\n  useEffect(() => {\r\n    fetchCategories();\r\n  }, []);\r\n\r\n  const fetchCategories = async () => {\r\n    try {\r\n      const res = await axios.get(\"http://localhost:5000/api/categories\");\r\n      setCategories(res.data);\r\n    } catch (error) {\r\n      console.error(\"Failed to fetch categories:\", error);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    try {\r\n      if (editingCategory) {\r\n        await axios.put(`http://localhost:5000/api/categories/${editingCategory._id}`, form);\r\n        toast.success(\"Cập nhật danh mục thành công!\");\r\n      } else {\r\n        await axios.post(\"http://localhost:5000/api/categories\", form);\r\n        toast.success(\"Thêm mới danh mục thành công!\");\r\n      }\r\n      setForm({ name: \"\", parent: null });\r\n      setEditingCategory(null);\r\n      \r\n      fetchCategories();\r\n    } catch (error) {\r\n      toast.error(\"Thêm/Sửa danh mục thất bại!\");\r\n      console.error(\"Failed to save category:\", error);\r\n    }\r\n  };\r\n\r\n  const handleEdit = (category) => {\r\n    setForm({ name: category.name, parent: category.parent });\r\n    setEditingCategory(category);\r\n    setFormData({ categories: [category._id, ...getAllChildIds(categories, category._id)] });\r\n  };\r\n\r\n  const handleDelete = async (id) => {\r\n    if (confirm(\"Bạn chắc chắn muốn xoá danh mục này chứ?\")) {\r\n      try {\r\n        await axios.delete(`http://localhost:5000/api/categories/${id}`);\r\n        toast.success(\"Xoá danh mục thành công!\");\r\n        fetchCategories();\r\n      } catch (error) {\r\n        toast.error(\"Xoá danh mục thất bại!\");\r\n        console.error(\"Failed to delete category:\", error);\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6 grid grid-cols-2\">\r\n      <div className=\"m-5\">\r\n        <h1 className=\"text-2xl mb-4\">Quản lí danh mục phụ tùng</h1>\r\n        <Card hoverScale={100}>\r\n          <CardContent>\r\n            <Input\r\n              placeholder=\"Tên phân loại\"\r\n              value={form.name}\r\n              onChange={(e) => setForm({ ...form, name: e.target.value })}\r\n            />\r\n            <select\r\n              value={form.parent || \"\"}\r\n              onChange={(e) => setForm({ ...form, parent: e.target.value })}\r\n              className=\"ml-2 mt-3 p-2 w-full border rounded\"\r\n            >\r\n              <option value=\"\">Không có danh mục cha</option>\r\n              {categories.map((category) => (\r\n                <option key={category._id} value={category._id}>\r\n                  {category.name}\r\n                </option>\r\n              ))}\r\n            </select>\r\n\r\n            <Button onClick={handleSubmit} className=\"ml-2 mt-3 bg-neutral-700 hover:bg-neutral-950\">\r\n              {editingCategory ? \"Sửa danh mục\" : \"Thêm danh mục\"}\r\n            </Button>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      <div className=\"m-5\">\r\n        {categories.map((category) => (\r\n          <Card key={category._id} event={() => handleEdit(category)} hoverScale={105}> \r\n            <CardContent>   \r\n              <div className=\"flex justify-between items-center\">\r\n                <div>\r\n                  <p>{category.name}</p>\r\n                  {category.parent && (\r\n                    <p className=\"text-sm text-gray-500\">\r\n                      Danh mục cha: {categories.find((c) => c._id === category.parent)?.name || \"Không có\"}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n                <div>\r\n                  <button onClick={() => handleDelete(category._id)} variant=\"destructive\" className=\"bg-white-700 p-5\">\r\n                    <AiFillDelete className=\"text-red-700\"/>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n      <ToastContainer position=\"top-right\" autoClose={3000} />\r\n    </div>\r\n  );\r\n}\r\n"
        }
    ]
}