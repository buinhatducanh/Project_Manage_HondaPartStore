{
    "sourceFile": "utils/withAuth.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 20,
            "patches": [
                {
                    "date": 1739378800814,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1739379438835,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,8 +19,9 @@\n       }\r\n     }, [user, router, allowedRoles]); // Thêm allowedRoles vào dependency\r\n \r\n     if (user === null) {\r\n+      console.log(user);\r\n       return <p>Đang kiểm tra quyền truy cập...</p>; // Hiển thị tạm thời trước khi xác thực xong\r\n     }\r\n \r\n     if (!user || !allowedRoles.includes(user.role)) {\r\n"
                },
                {
                    "date": 1739379530963,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,27 +6,36 @@\n     const router = useRouter();\r\n     const [user, setUser] = useState(null);\r\n \r\n     useEffect(() => {\r\n-      if (typeof window !== \"undefined\") {\r\n-        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n+      const loadUser = () => {\r\n+        const storedUser = typeof window !== \"undefined\" ? JSON.parse(localStorage.getItem(\"user\")) : null;\r\n         setUser(storedUser);\r\n-      }\r\n-    }, []); // Chỉ chạy 1 lần sau khi component mount\r\n+      };\r\n \r\n+      // Lần đầu tiên load user\r\n+      loadUser();\r\n+\r\n+      // Lắng nghe sự kiện storage khi user đăng xuất hoặc thay đổi quyền\r\n+      window.addEventListener(\"storage\", loadUser);\r\n+\r\n+      return () => {\r\n+        window.removeEventListener(\"storage\", loadUser);\r\n+      };\r\n+    }, []);\r\n+\r\n     useEffect(() => {\r\n       if (user !== null && (!user || !allowedRoles.includes(user.role))) {\r\n         router.push(\"/login\");\r\n       }\r\n-    }, [user, router, allowedRoles]); // Thêm allowedRoles vào dependency\r\n+    }, [user, router, allowedRoles]);\r\n \r\n     if (user === null) {\r\n-      console.log(user);\r\n-      return <p>Đang kiểm tra quyền truy cập...</p>; // Hiển thị tạm thời trước khi xác thực xong\r\n+      return <p>Đang kiểm tra quyền truy cập...</p>;\r\n     }\r\n \r\n     if (!user || !allowedRoles.includes(user.role)) {\r\n-      return null; // Chặn hiển thị UI nếu không đủ quyền\r\n+      return null;\r\n     }\r\n \r\n     return <WrappedComponent {...props} />;\r\n   };\r\n"
                },
                {
                    "date": 1739379618306,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,36 +6,27 @@\n     const router = useRouter();\r\n     const [user, setUser] = useState(null);\r\n \r\n     useEffect(() => {\r\n-      const loadUser = () => {\r\n-        const storedUser = typeof window !== \"undefined\" ? JSON.parse(localStorage.getItem(\"user\")) : null;\r\n+      if (typeof window !== \"undefined\") {\r\n+        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n         setUser(storedUser);\r\n-      };\r\n+      }\r\n+    }, []); // Chỉ chạy 1 lần sau khi component mount\r\n \r\n-      // Lần đầu tiên load user\r\n-      loadUser();\r\n-\r\n-      // Lắng nghe sự kiện storage khi user đăng xuất hoặc thay đổi quyền\r\n-      window.addEventListener(\"storage\", loadUser);\r\n-\r\n-      return () => {\r\n-        window.removeEventListener(\"storage\", loadUser);\r\n-      };\r\n-    }, []);\r\n-\r\n     useEffect(() => {\r\n       if (user !== null && (!user || !allowedRoles.includes(user.role))) {\r\n         router.push(\"/login\");\r\n       }\r\n-    }, [user, router, allowedRoles]);\r\n+    }, [user, router, allowedRoles]); // Thêm allowedRoles vào dependency\r\n \r\n     if (user === null) {\r\n-      return <p>Đang kiểm tra quyền truy cập...</p>;\r\n+      console.log(user);\r\n+      return <p>Đang kiểm tra quyền truy cập...</p>; // Hiển thị tạm thời trước khi xác thực xong\r\n     }\r\n \r\n     if (!user || !allowedRoles.includes(user.role)) {\r\n-      return null;\r\n+      return null; // Chặn hiển thị UI nếu không đủ quyền\r\n     }\r\n \r\n     return <WrappedComponent {...props} />;\r\n   };\r\n"
                },
                {
                    "date": 1739379683084,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,44 @@\n+import { useEffect, useState } from \"react\";\r\n+import { useRouter } from \"next/router\";\r\n+\r\n+const withAuth = (WrappedComponent, allowedRoles) => {\r\n+  return (props) => {\r\n+    const router = useRouter();\r\n+    const [user, setUser] = useState(null);\r\n+\r\n+    useEffect(() => {\r\n+      if (typeof window !== \"undefined\") {\r\n+        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n+        setUser(storedUser);\r\n+      }\r\n+\r\n+      // Kiểm tra sau 5 giây nếu vẫn chưa có user\r\n+      const timer = setTimeout(() => {\r\n+        if (user === null) {\r\n+          alert(\"Có lỗi xảy ra khi đăng nhập. Vui lòng đăng nhập lại!\");\r\n+          router.push(\"/login\");\r\n+        }\r\n+      }, 5000);\r\n+\r\n+      return () => clearTimeout(timer); // Xóa timer khi component unmount\r\n+    }, [user, router]);\r\n+\r\n+    useEffect(() => {\r\n+      if (user !== null && (!user || !allowedRoles.includes(user.role))) {\r\n+        router.push(\"/login\");\r\n+      }\r\n+    }, [user, router, allowedRoles]);\r\n+\r\n+    if (user === null) {\r\n+      return <p>Đang kiểm tra quyền truy cập...</p>; // Hiển thị tạm thời trước khi xác thực xong\r\n+    }\r\n+\r\n+    if (!user || !allowedRoles.includes(user.role)) {\r\n+      return null; // Chặn hiển thị UI nếu không đủ quyền\r\n+    }\r\n+\r\n+    return <WrappedComponent {...props} />;\r\n+  };\r\n+};\r\n+\r\n+export default withAuth;\r\n"
                },
                {
                    "date": 1739379933454,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,43 @@\n+import { useEffect, useState } from \"react\";\r\n+import { useRouter } from \"next/router\";\r\n+import Alert from \"../components/Alert\"; // Import Alert component\r\n+\r\n+const withAuth = (WrappedComponent, allowedRoles) => {\r\n+  return (props) => {\r\n+    const router = useRouter();\r\n+    const [user, setUser] = useState(null);\r\n+    const [error, setError] = useState(null); // State lưu lỗi\r\n+\r\n+    useEffect(() => {\r\n+      if (typeof window !== \"undefined\") {\r\n+        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n+        setUser(storedUser);\r\n+      }\r\n+    }, []);\r\n+\r\n+    useEffect(() => {\r\n+      if (user === null) {\r\n+        const timer = setTimeout(() => {\r\n+          setError(\"Có lỗi xảy ra khi đăng nhập. Vui lòng đăng nhập lại!\");\r\n+          router.push(\"/login\");\r\n+        }, 5000);\r\n+        return () => clearTimeout(timer);\r\n+      }\r\n+    }, [user, router]);\r\n+\r\n+    useEffect(() => {\r\n+      if (user && !allowedRoles.includes(user.role)) {\r\n+        router.push(\"/login\");\r\n+      }\r\n+    }, [user, router, allowedRoles]);\r\n+\r\n+    return (\r\n+      <>\r\n+        {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n+        {user === null ? <p>Đang kiểm tra quyền truy cập...</p> : <WrappedComponent {...props} />}\r\n+      </>\r\n+    );\r\n+  };\r\n+};\r\n+\r\n+export default withAuth;\r\n"
                },
                {
                    "date": 1739380075867,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -40,83 +40,4 @@\n   };\r\n };\r\n \r\n export default withAuth;\r\n-import { useEffect, useState } from \"react\";\r\n-import { useRouter } from \"next/router\";\r\n-\r\n-const withAuth = (WrappedComponent, allowedRoles) => {\r\n-  return (props) => {\r\n-    const router = useRouter();\r\n-    const [user, setUser] = useState(null);\r\n-\r\n-    useEffect(() => {\r\n-      if (typeof window !== \"undefined\") {\r\n-        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n-        setUser(storedUser);\r\n-      }\r\n-\r\n-      // Kiểm tra sau 5 giây nếu vẫn chưa có user\r\n-      const timer = setTimeout(() => {\r\n-        if (user === null) {\r\n-          alert(\"Có lỗi xảy ra khi đăng nhập. Vui lòng đăng nhập lại!\");\r\n-          router.push(\"/login\");\r\n-        }\r\n-      }, 5000);\r\n-\r\n-      return () => clearTimeout(timer); // Xóa timer khi component unmount\r\n-    }, [user, router]);\r\n-\r\n-    useEffect(() => {\r\n-      if (user !== null && (!user || !allowedRoles.includes(user.role))) {\r\n-        router.push(\"/login\");\r\n-      }\r\n-    }, [user, router, allowedRoles]);\r\n-\r\n-    if (user === null) {\r\n-      return <p>Đang kiểm tra quyền truy cập...</p>; // Hiển thị tạm thời trước khi xác thực xong\r\n-    }\r\n-\r\n-    if (!user || !allowedRoles.includes(user.role)) {\r\n-      return null; // Chặn hiển thị UI nếu không đủ quyền\r\n-    }\r\n-\r\n-    return <WrappedComponent {...props} />;\r\n-  };\r\n-};\r\n-\r\n-export default withAuth;\r\n-import { useEffect, useState } from \"react\";\r\n-import { useRouter } from \"next/router\";\r\n-\r\n-const withAuth = (WrappedComponent, allowedRoles) => {\r\n-  return (props) => {\r\n-    const router = useRouter();\r\n-    const [user, setUser] = useState(null);\r\n-\r\n-    useEffect(() => {\r\n-      if (typeof window !== \"undefined\") {\r\n-        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n-        setUser(storedUser);\r\n-      }\r\n-    }, []); // Chỉ chạy 1 lần sau khi component mount\r\n-\r\n-    useEffect(() => {\r\n-      if (user !== null && (!user || !allowedRoles.includes(user.role))) {\r\n-        router.push(\"/login\");\r\n-      }\r\n-    }, [user, router, allowedRoles]); // Thêm allowedRoles vào dependency\r\n-\r\n-    if (user === null) {\r\n-      console.log(user);\r\n-      return <p>Đang kiểm tra quyền truy cập...</p>; // Hiển thị tạm thời trước khi xác thực xong\r\n-    }\r\n-\r\n-    if (!user || !allowedRoles.includes(user.role)) {\r\n-      return null; // Chặn hiển thị UI nếu không đủ quyền\r\n-    }\r\n-\r\n-    return <WrappedComponent {...props} />;\r\n-  };\r\n-};\r\n-\r\n-export default withAuth;\r\n"
                },
                {
                    "date": 1739448322563,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,9 +33,9 @@\n \r\n     return (\r\n       <>\r\n         {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n-        {user === null ? <p>Đang kiểm tra quyền truy cập...</p> : <WrappedComponent {...props} />}\r\n+        {user === null ? <p className=\"h-[100vh]\">Đang kiểm tra quyền truy cập...</p> : <WrappedComponent {...props} />}\r\n       </>\r\n     );\r\n   };\r\n };\r\n"
                },
                {
                    "date": 1739448333246,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,9 +33,9 @@\n \r\n     return (\r\n       <>\r\n         {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n-        {user === null ? <p className=\"h-[100vh]\">Đang kiểm tra quyền truy cập...</p> : <WrappedComponent {...props} />}\r\n+        {user === null ? <p className=\"h-5\">Đang kiểm tra quyền truy cập...</p> : <WrappedComponent {...props} />}\r\n       </>\r\n     );\r\n   };\r\n };\r\n"
                },
                {
                    "date": 1739448392025,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,9 +33,12 @@\n \r\n     return (\r\n       <>\r\n         {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n-        {user === null ? <p className=\"h-5\">Đang kiểm tra quyền truy cập...</p> : <WrappedComponent {...props} />}\r\n+        {user === null ?\r\n+          <div><p className=\"h-5\">Đang kiểm tra quyền truy cập...</p></div>\r\n+          : <WrappedComponent {...props} />\r\n+        }\r\n       </>\r\n     );\r\n   };\r\n };\r\n"
                },
                {
                    "date": 1739448418806,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,46 @@\n+import { useEffect, useState } from \"react\";\r\n+import { useRouter } from \"next/router\";\r\n+import Alert from \"../components/Alert\"; // Import Alert component\r\n+\r\n+const withAuth = (WrappedComponent, allowedRoles) => {\r\n+  return (props) => {\r\n+    const router = useRouter();\r\n+    const [user, setUser] = useState(null);\r\n+    const [error, setError] = useState(null); // State lưu lỗi\r\n+\r\n+    useEffect(() => {\r\n+      if (typeof window !== \"undefined\") {\r\n+        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n+        setUser(storedUser);\r\n+      }\r\n+    }, []);\r\n+\r\n+    useEffect(() => {\r\n+      if (user === null) {\r\n+        const timer = setTimeout(() => {\r\n+          setError(\"Có lỗi xảy ra khi đăng nhập. Vui lòng đăng nhập lại!\");\r\n+          router.push(\"/login\");\r\n+        }, 5000);\r\n+        return () => clearTimeout(timer);\r\n+      }\r\n+    }, [user, router]);\r\n+\r\n+    useEffect(() => {\r\n+      if (user && !allowedRoles.includes(user.role)) {\r\n+        router.push(\"/login\");\r\n+      }\r\n+    }, [user, router, allowedRoles]);\r\n+\r\n+    return (\r\n+      <>\r\n+        {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n+        {user === null ?\r\n+          <div className=\"text-gray-500\" ><p>Đang kiểm tra quyền truy cập...</p></div>\r\n+          : <WrappedComponent {...props} />\r\n+        }\r\n+      </>\r\n+    );\r\n+  };\r\n+};\r\n+\r\n+export default withAuth;\r\n"
                },
                {
                    "date": 1739448626568,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,46 @@\n+import { useEffect, useState } from \"react\";\r\n+import { useRouter } from \"next/router\";\r\n+import Alert from \"../components/Alert\"; // Import Alert component\r\n+\r\n+const withAuth = (WrappedComponent, allowedRoles) => {\r\n+  return (props) => {\r\n+    const router = useRouter();\r\n+    const [user, setUser] = useState(null);\r\n+    const [error, setError] = useState(null); // State lưu lỗi\r\n+\r\n+    useEffect(() => {\r\n+      if (typeof window !== \"undefined\") {\r\n+        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n+        setUser(storedUser);\r\n+      }\r\n+    }, []);\r\n+\r\n+    useEffect(() => {\r\n+      if (user === null) {\r\n+        const timer = setTimeout(() => {\r\n+          setError(\"Có lỗi xảy ra khi đăng nhập. Vui lòng đăng nhập lại!\");\r\n+          router.push(\"/login\");\r\n+        }, 5000);\r\n+        return () => clearTimeout(timer);\r\n+      }\r\n+    }, [user, router]);\r\n+\r\n+    useEffect(() => {\r\n+      if (user && !allowedRoles.includes(user.role)) {\r\n+        router.push(\"/login\");\r\n+      }\r\n+    }, [user, router, allowedRoles]);\r\n+\r\n+    return (\r\n+      <>\r\n+        {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n+        {user === null ?\r\n+          <div className=\"h-screen\" ><p>Đang kiểm tra quyền truy cập...</p></div>\r\n+          : <WrappedComponent {...props} />\r\n+        }\r\n+      </>\r\n+    );\r\n+  };\r\n+};\r\n+\r\n+export default withAuth;\r\n"
                },
                {
                    "date": 1739448716633,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,46 @@\n+import { useEffect, useState } from \"react\";\r\n+import { useRouter } from \"next/router\";\r\n+import Alert from \"../components/Alert\"; // Import Alert component\r\n+\r\n+const withAuth = (WrappedComponent, allowedRoles) => {\r\n+  return (props) => {\r\n+    const router = useRouter();\r\n+    const [user, setUser] = useState(null);\r\n+    const [error, setError] = useState(null); // State lưu lỗi\r\n+\r\n+    useEffect(() => {\r\n+      if (typeof window !== \"undefined\") {\r\n+        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n+        setUser(storedUser);\r\n+      }\r\n+    }, []);\r\n+\r\n+    useEffect(() => {\r\n+      if (user === null) {\r\n+        const timer = setTimeout(() => {\r\n+          setError(\"Có lỗi xảy ra khi đăng nhập. Vui lòng đăng nhập lại!\");\r\n+          router.push(\"/login\");\r\n+        }, 5000);\r\n+        return () => clearTimeout(timer);\r\n+      }\r\n+    }, [user, router]);\r\n+\r\n+    useEffect(() => {\r\n+      if (user && !allowedRoles.includes(user.role)) {\r\n+        router.push(\"/login\");\r\n+      }\r\n+    }, [user, router, allowedRoles]);\r\n+\r\n+    return (\r\n+      <>\r\n+        {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n+        {user === null ?\r\n+          <div className=\"h-screen\"><p>Đang kiểm tra quyền truy cập...</p></div>\r\n+          : <WrappedComponent {...props} />\r\n+        }\r\n+      </>\r\n+    );\r\n+  };\r\n+};\r\n+\r\n+export default withAuth;\r\n"
                },
                {
                    "date": 1739449813626,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,46 @@\n+import { useEffect, useState } from \"react\";\r\n+import { useRouter } from \"next/router\";\r\n+import Alert from \"../components/Alert\"; // Import Alert component\r\n+\r\n+const withAuth = (WrappedComponent, allowedRoles) => {\r\n+  return (props) => {\r\n+    const router = useRouter();\r\n+    const [user, setUser] = useState(null);\r\n+    const [error, setError] = useState(null); // State lưu lỗi\r\n+\r\n+    useEffect(() => {\r\n+      if (typeof window !== \"undefined\") {\r\n+        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n+        setUser(storedUser);\r\n+      }\r\n+    }, []);\r\n+\r\n+    useEffect(() => {\r\n+      if (user === null) {\r\n+        const timer = setTimeout(() => {\r\n+          setError(\"Có lỗi xảy ra khi đăng nhập. Vui lòng đăng nhập lại!\");\r\n+          router.push(\"/login\");\r\n+        }, 2000);\r\n+        return () => clearTimeout(timer);\r\n+      }\r\n+    }, [user, router]);\r\n+\r\n+    useEffect(() => {\r\n+      if (user && !allowedRoles.includes(user.role)) {\r\n+        router.push(\"/login\");\r\n+      }\r\n+    }, [user, router, allowedRoles]);\r\n+\r\n+    return (\r\n+      <>\r\n+        {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n+        {user === null ?\r\n+          <div className=\"h-screen\"><p>Đang kiểm tra quyền truy cập...</p></div>\r\n+          : <WrappedComponent {...props} />\r\n+        }\r\n+      </>\r\n+    );\r\n+  };\r\n+};\r\n+\r\n+export default withAuth;\r\n"
                },
                {
                    "date": 1739449827967,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n     return (\r\n       <>\r\n         {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n         {user === null ?\r\n-          <div className=\"h-screen\"><p>Đang kiểm tra quyền truy cập...</p></div>\r\n+          <div className=\"h-screen m-10\"><p>Đang kiểm tra quyền truy cập...</p></div>\r\n           : <WrappedComponent {...props} />\r\n         }\r\n       </>\r\n     );\r\n"
                },
                {
                    "date": 1739449835409,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n     return (\r\n       <>\r\n         {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n         {user === null ?\r\n-          <div className=\"h-screen m-10\"><p>Đang kiểm tra quyền truy cập...</p></div>\r\n+          <div className=\"h-screen\"><p className=\"m-10\">Đang kiểm tra quyền truy cập...</p></div>\r\n           : <WrappedComponent {...props} />\r\n         }\r\n       </>\r\n     );\r\n"
                },
                {
                    "date": 1739449862795,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,48 @@\n+import { useEffect, useState } from \"react\";\r\n+import { useRouter } from \"next/router\";\r\n+import Alert from \"../components/Alert\"; // Import Alert component\r\n+\r\n+const withAuth = (WrappedComponent, allowedRoles) => {\r\n+  return (props) => {\r\n+    const router = useRouter();\r\n+    const [user, setUser] = useState(null);\r\n+    const [error, setError] = useState(null); // State lưu lỗi\r\n+\r\n+    useEffect(() => {\r\n+      if (typeof window !== \"undefined\") {\r\n+        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n+        setUser(storedUser);\r\n+      }\r\n+    }, []);\r\n+\r\n+    useEffect(() => {\r\n+      if (user === null) {\r\n+        const timer = setTimeout(() => {\r\n+          setError(\"Có lỗi xảy ra khi đăng nhập. Vui lòng đăng nhập lại!\");\r\n+          router.push(\"/login\");\r\n+        }, 2000);\r\n+        return () => clearTimeout(timer);\r\n+      }\r\n+    }, [user, router]);\r\n+\r\n+    useEffect(() => {\r\n+      if (user && !allowedRoles.includes(user.role)) {\r\n+        router.push(\"/login\");\r\n+      }\r\n+    }, [user, router, allowedRoles]);\r\n+\r\n+    return (\r\n+      <>\r\n+      <div className=\"h-screen\">\r\n+        {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n+        {user === null ?\r\n+          <p>Đang kiểm tra quyền truy cập...</p>\r\n+          : <WrappedComponent {...props} />\r\n+        }\r\n+      </div>\r\n+      </>\r\n+    );\r\n+  };\r\n+};\r\n+\r\n+export default withAuth;\r\n"
                },
                {
                    "date": 1739449872105,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,48 @@\n+import { useEffect, useState } from \"react\";\r\n+import { useRouter } from \"next/router\";\r\n+import Alert from \"../components/Alert\"; // Import Alert component\r\n+\r\n+const withAuth = (WrappedComponent, allowedRoles) => {\r\n+  return (props) => {\r\n+    const router = useRouter();\r\n+    const [user, setUser] = useState(null);\r\n+    const [error, setError] = useState(null); // State lưu lỗi\r\n+\r\n+    useEffect(() => {\r\n+      if (typeof window !== \"undefined\") {\r\n+        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n+        setUser(storedUser);\r\n+      }\r\n+    }, []);\r\n+\r\n+    useEffect(() => {\r\n+      if (user === null) {\r\n+        const timer = setTimeout(() => {\r\n+          setError(\"Có lỗi xảy ra khi đăng nhập. Vui lòng đăng nhập lại!\");\r\n+          router.push(\"/login\");\r\n+        }, 2000);\r\n+        return () => clearTimeout(timer);\r\n+      }\r\n+    }, [user, router]);\r\n+\r\n+    useEffect(() => {\r\n+      if (user && !allowedRoles.includes(user.role)) {\r\n+        router.push(\"/login\");\r\n+      }\r\n+    }, [user, router, allowedRoles]);\r\n+\r\n+    return (\r\n+      <>\r\n+      <div className=\"m-screen\">\r\n+        {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n+        {user === null ?\r\n+          <p>Đang kiểm tra quyền truy cập...</p>\r\n+          : <WrappedComponent {...props} />\r\n+        }\r\n+      </div>\r\n+      </>\r\n+    );\r\n+  };\r\n+};\r\n+\r\n+export default withAuth;\r\n"
                },
                {
                    "date": 1739449881406,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,15 +32,13 @@\n     }, [user, router, allowedRoles]);\r\n \r\n     return (\r\n       <>\r\n-      <div className=\"m-screen\">\r\n         {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n         {user === null ?\r\n           <p>Đang kiểm tra quyền truy cập...</p>\r\n           : <WrappedComponent {...props} />\r\n         }\r\n-      </div>\r\n       </>\r\n     );\r\n   };\r\n };\r\n"
                },
                {
                    "date": 1739450119543,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,46 @@\n+import { useEffect, useState } from \"react\";\r\n+import { useRouter } from \"next/router\";\r\n+import Alert from \"../components/Alert\"; // Import Alert component\r\n+\r\n+const withAuth = (WrappedComponent, allowedRoles) => {\r\n+  return (props) => {\r\n+    const router = useRouter();\r\n+    const [user, setUser] = useState(null);\r\n+    const [error, setError] = useState(null); // State lưu lỗi\r\n+\r\n+    useEffect(() => {\r\n+      if (typeof window !== \"undefined\") {\r\n+        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n+        setUser(storedUser);\r\n+      }\r\n+    }, []);\r\n+\r\n+    useEffect(() => {\r\n+      if (user === null) {\r\n+        const timer = setTimeout(() => {\r\n+          setError(\"Có lỗi xảy ra khi đăng nhập. Vui lòng đăng nhập lại!\");\r\n+          router.push(\"/login\");\r\n+        }, 2000);\r\n+        return () => clearTimeout(timer);\r\n+      }\r\n+    }, [user, router]);\r\n+\r\n+    useEffect(() => {\r\n+      if (user && !allowedRoles.includes(user.role)) {\r\n+        router.push(\"/login\");\r\n+      }\r\n+    }, [user, router, allowedRoles]);\r\n+\r\n+    return (\r\n+      <>\r\n+        {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n+        {user === null ?\r\n+          <p className=\"text-align-center\">Đang kiểm tra quyền truy cập...</p>\r\n+          : <WrappedComponent {...props} />\r\n+        }\r\n+      </>\r\n+    );\r\n+  };\r\n+};\r\n+\r\n+export default withAuth;\r\n"
                },
                {
                    "date": 1739450139550,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,46 @@\n+import { useEffect, useState } from \"react\";\r\n+import { useRouter } from \"next/router\";\r\n+import Alert from \"../components/Alert\"; // Import Alert component\r\n+\r\n+const withAuth = (WrappedComponent, allowedRoles) => {\r\n+  return (props) => {\r\n+    const router = useRouter();\r\n+    const [user, setUser] = useState(null);\r\n+    const [error, setError] = useState(null); // State lưu lỗi\r\n+\r\n+    useEffect(() => {\r\n+      if (typeof window !== \"undefined\") {\r\n+        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n+        setUser(storedUser);\r\n+      }\r\n+    }, []);\r\n+\r\n+    useEffect(() => {\r\n+      if (user === null) {\r\n+        const timer = setTimeout(() => {\r\n+          setError(\"Có lỗi xảy ra khi đăng nhập. Vui lòng đăng nhập lại!\");\r\n+          router.push(\"/login\");\r\n+        }, 2000);\r\n+        return () => clearTimeout(timer);\r\n+      }\r\n+    }, [user, router]);\r\n+\r\n+    useEffect(() => {\r\n+      if (user && !allowedRoles.includes(user.role)) {\r\n+        router.push(\"/login\");\r\n+      }\r\n+    }, [user, router, allowedRoles]);\r\n+\r\n+    return (\r\n+      <>\r\n+        {error && <Alert type=\"error\" message={error} />} {/* Hiển thị thông báo lỗi */}\r\n+        {user === null ?\r\n+          <p className=\"text-center\">Đang kiểm tra quyền truy cập...</p>\r\n+          : <WrappedComponent {...props} />\r\n+        }\r\n+      </>\r\n+    );\r\n+  };\r\n+};\r\n+\r\n+export default withAuth;\r\n"
                }
            ],
            "date": 1739378800814,
            "name": "Commit-0",
            "content": "import { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/router\";\r\n\r\nconst withAuth = (WrappedComponent, allowedRoles) => {\r\n  return (props) => {\r\n    const router = useRouter();\r\n    const [user, setUser] = useState(null);\r\n\r\n    useEffect(() => {\r\n      if (typeof window !== \"undefined\") {\r\n        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n        setUser(storedUser);\r\n      }\r\n    }, []); // Chỉ chạy 1 lần sau khi component mount\r\n\r\n    useEffect(() => {\r\n      if (user !== null && (!user || !allowedRoles.includes(user.role))) {\r\n        router.push(\"/login\");\r\n      }\r\n    }, [user, router, allowedRoles]); // Thêm allowedRoles vào dependency\r\n\r\n    if (user === null) {\r\n      return <p>Đang kiểm tra quyền truy cập...</p>; // Hiển thị tạm thời trước khi xác thực xong\r\n    }\r\n\r\n    if (!user || !allowedRoles.includes(user.role)) {\r\n      return null; // Chặn hiển thị UI nếu không đủ quyền\r\n    }\r\n\r\n    return <WrappedComponent {...props} />;\r\n  };\r\n};\r\n\r\nexport default withAuth;\r\n"
        }
    ]
}