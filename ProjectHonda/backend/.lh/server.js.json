{
    "sourceFile": "server.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 21,
            "patches": [
                {
                    "date": 1738055979415,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1738059317004,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,21 +1,21 @@\n const express = require(\"express\");\r\n const mongoose = require(\"mongoose\");\r\n-const cors = require(\"cors\");\r\n-require(\"dotenv\").config();\r\n+const productRouter = require(\"./routes/products\");  // Đường dẫn tới router sản phẩm\r\n \r\n const app = express();\r\n-app.use(cors());\r\n+\r\n+// Kết nối tới MongoDB\r\n+mongoose.connect(\"mongodb://localhost:27017/hondaParts\", { useNewUrlParser: true, useUnifiedTopology: true })\r\n+  .then(() => console.log(\"Connected to MongoDB\"))\r\n+  .catch((err) => console.log(\"Error connecting to MongoDB:\", err));\r\n+\r\n+// Middleware để parse dữ liệu JSON\r\n app.use(express.json());\r\n \r\n-// MongoDB Connection\r\n-mongoose.connect(process.env.MONGO_URI, {\r\n-  useNewUrlParser: true,\r\n-  useUnifiedTopology: true,\r\n-}).then(() => console.log(\"MongoDB connected\"))\r\n-  .catch(err => console.error(err));\r\n+// Sử dụng router cho sản phẩm\r\n+app.use(\"/api/products\", productRouter);\r\n \r\n-// Routes\r\n-app.use(\"/api/products\", require(\"./routes/productRoutes\"));\r\n-\r\n-const PORT = process.env.PORT || 5000;\r\n-app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n+// Lắng nghe trên cổng 5000\r\n+app.listen(5000, () => {\r\n+  console.log(\"Server running on port 5000\");\r\n+});\r\n"
                },
                {
                    "date": 1738059369015,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,7 @@\n const express = require(\"express\");\r\n const mongoose = require(\"mongoose\");\r\n-const productRouter = require(\"./routes/products\");  // Đường dẫn tới router sản phẩm\r\n+const productRouter = require(\"./routes/productRoutes\");  // Đường dẫn tới router sản phẩm\r\n \r\n const app = express();\r\n \r\n // Kết nối tới MongoDB\r\n"
                },
                {
                    "date": 1738059841542,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,21 +1,21 @@\n const express = require(\"express\");\r\n const mongoose = require(\"mongoose\");\r\n-const productRouter = require(\"./routes/productRoutes\");  // Đường dẫn tới router sản phẩm\r\n+const cors = require(\"cors\");\r\n+require(\"dotenv\").config();\r\n \r\n const app = express();\r\n+app.use(cors());\r\n+app.use(express.json());\r\n \r\n-// Kết nối tới MongoDB\r\n-mongoose.connect(\"mongodb://localhost:27017/hondaParts\", { useNewUrlParser: true, useUnifiedTopology: true })\r\n-  .then(() => console.log(\"Connected to MongoDB\"))\r\n-  .catch((err) => console.log(\"Error connecting to MongoDB:\", err));\r\n+// MongoDB Connection\r\n+mongoose.connect(process.env.MONGO_URI, {\r\n+  useNewUrlParser: true,\r\n+  useUnifiedTopology: true,\r\n+}).then(() => console.log(\"MongoDB connected\"))\r\n+  .catch(err => console.error(err));\r\n \r\n-// Middleware để parse dữ liệu JSON\r\n-app.use(express.json());\r\n+// Routes\r\n+app.use(\"/api/products\", require(\"./routes/productRoutes\"));\r\n \r\n-// Sử dụng router cho sản phẩm\r\n-app.use(\"/api/products\", productRouter);\r\n-\r\n-// Lắng nghe trên cổng 5000\r\n-app.listen(5000, () => {\r\n-  console.log(\"Server running on port 5000\");\r\n-});\r\n+const PORT = process.env.PORT || 5000;\r\n+app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                },
                {
                    "date": 1738064182626,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,19 +3,23 @@\n const cors = require(\"cors\");\r\n require(\"dotenv\").config();\r\n \r\n const app = express();\r\n+\r\n+// Middleware\r\n app.use(cors());\r\n app.use(express.json());\r\n \r\n-// MongoDB Connection\r\n+// Kết nối MongoDB\r\n mongoose.connect(process.env.MONGO_URI, {\r\n   useNewUrlParser: true,\r\n   useUnifiedTopology: true,\r\n }).then(() => console.log(\"MongoDB connected\"))\r\n-  .catch(err => console.error(err));\r\n+  .catch(err => console.error(\"MongoDB connection error: \", err));\r\n \r\n // Routes\r\n-app.use(\"/api/products\", require(\"./routes/productRoutes\"));\r\n+const productRoutes = require(\"./routes/productRoutes\");\r\n+app.use(\"/api/products\", productRoutes);\r\n \r\n+// Khởi động server\r\n const PORT = process.env.PORT || 5000;\r\n app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                },
                {
                    "date": 1738064402430,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,23 +3,23 @@\n const cors = require(\"cors\");\r\n require(\"dotenv\").config();\r\n \r\n const app = express();\r\n-\r\n-// Middleware\r\n app.use(cors());\r\n app.use(express.json());\r\n \r\n // Kết nối MongoDB\r\n mongoose.connect(process.env.MONGO_URI, {\r\n   useNewUrlParser: true,\r\n   useUnifiedTopology: true,\r\n }).then(() => console.log(\"MongoDB connected\"))\r\n-  .catch(err => console.error(\"MongoDB connection error: \", err));\r\n+  .catch(err => console.error(err));\r\n \r\n // Routes\r\n-const productRoutes = require(\"./routes/productRoutes\");\r\n-app.use(\"/api/products\", productRoutes);\r\n+app.use(\"/api/products\", require(\"./routes/productRoutes\"));\r\n+app.use(\"/api/users\", require(\"./routes/userRoutes\"));\r\n+app.use(\"/api/orders\", require(\"./routes/orderRoutes\"));\r\n+app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n \r\n // Khởi động server\r\n const PORT = process.env.PORT || 5000;\r\n app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                },
                {
                    "date": 1738068413111,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,8 +18,9 @@\n app.use(\"/api/products\", require(\"./routes/productRoutes\"));\r\n app.use(\"/api/users\", require(\"./routes/userRoutes\"));\r\n app.use(\"/api/orders\", require(\"./routes/orderRoutes\"));\r\n app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n+app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));  // Thêm route category\r\n \r\n // Khởi động server\r\n const PORT = process.env.PORT || 5000;\r\n app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                },
                {
                    "date": 1738757771766,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,10 @@\n app.use(\"/api/products\", require(\"./routes/productRoutes\"));\r\n app.use(\"/api/users\", require(\"./routes/userRoutes\"));\r\n app.use(\"/api/orders\", require(\"./routes/orderRoutes\"));\r\n app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n-app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));  // Thêm route category\r\n+app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));\r\n+app.use(\"/api/motorcycles\", require(\"./routes/motorcycleRoutes\"));  // Thêm route category\r\n \r\n // Khởi động server\r\n const PORT = process.env.PORT || 5000;\r\n app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                },
                {
                    "date": 1738858309211,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n app.use(\"/api/users\", require(\"./routes/userRoutes\"));\r\n app.use(\"/api/orders\", require(\"./routes/orderRoutes\"));\r\n app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));\r\n-app.use(\"/api/motorcycles\", require(\"./routes/motorcycleRoutes\"));  // Thêm route category\r\n+app.use(\"/api/brand\", require(\"./routes/brandRoutes\"));  // Thêm route category\r\n \r\n // Khởi động server\r\n const PORT = process.env.PORT || 5000;\r\n app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                },
                {
                    "date": 1738858318799,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n app.use(\"/api/users\", require(\"./routes/userRoutes\"));\r\n app.use(\"/api/orders\", require(\"./routes/orderRoutes\"));\r\n app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));\r\n-app.use(\"/api/brand\", require(\"./routes/brandRoutes\"));  // Thêm route category\r\n+app.use(\"/api/brand\", require(\"./routes/brandRoutes\")); \r\n \r\n // Khởi động server\r\n const PORT = process.env.PORT || 5000;\r\n app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                },
                {
                    "date": 1738859226818,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,8 +14,9 @@\n }).then(() => console.log(\"MongoDB connected\"))\r\n   .catch(err => console.error(err));\r\n \r\n // Routes\r\n+app.use(\"/uploads\", express.static(\"uploads\"));\r\n app.use(\"/api/products\", require(\"./routes/productRoutes\"));\r\n app.use(\"/api/users\", require(\"./routes/userRoutes\"));\r\n app.use(\"/api/orders\", require(\"./routes/orderRoutes\"));\r\n app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n"
                },
                {
                    "date": 1738860401146,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,9 +20,9 @@\n app.use(\"/api/users\", require(\"./routes/userRoutes\"));\r\n app.use(\"/api/orders\", require(\"./routes/orderRoutes\"));\r\n app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));\r\n-app.use(\"/api/brand\", require(\"./routes/brandRoutes\")); \r\n+app.use(\"/api/brands\", require(\"./routes/brandRoutes\")); \r\n \r\n // Khởi động server\r\n const PORT = process.env.PORT || 5000;\r\n app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                },
                {
                    "date": 1738909815484,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,8 +21,9 @@\n app.use(\"/api/orders\", require(\"./routes/orderRoutes\"));\r\n app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));\r\n app.use(\"/api/brands\", require(\"./routes/brandRoutes\")); \r\n+app.use(\"/api/slides\", require(\"./routes/slidesRoutes\"));\r\n \r\n // Khởi động server\r\n const PORT = process.env.PORT || 5000;\r\n app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                },
                {
                    "date": 1738927203987,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,8 +22,9 @@\n app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));\r\n app.use(\"/api/brands\", require(\"./routes/brandRoutes\")); \r\n app.use(\"/api/slides\", require(\"./routes/slidesRoutes\"));\r\n+app.use(\"/api/images\", require(\"./routes/imageRoutes\"));\r\n \r\n // Khởi động server\r\n const PORT = process.env.PORT || 5000;\r\n app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                },
                {
                    "date": 1739007417779,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,7 +24,16 @@\n app.use(\"/api/brands\", require(\"./routes/brandRoutes\")); \r\n app.use(\"/api/slides\", require(\"./routes/slidesRoutes\"));\r\n app.use(\"/api/images\", require(\"./routes/imageRoutes\"));\r\n \r\n+process.on(\"uncaughtException\", (err) => {\r\n+  console.error(\"Uncaught Exception:\", err);\r\n+});\r\n+\r\n+process.on(\"unhandledRejection\", (err) => {\r\n+  console.error(\"Unhandled Rejection:\", err);\r\n+});\r\n+\r\n+\r\n // Khởi động server\r\n const PORT = process.env.PORT || 5000;\r\n app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                },
                {
                    "date": 1739007438864,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,16 +24,8 @@\n app.use(\"/api/brands\", require(\"./routes/brandRoutes\")); \r\n app.use(\"/api/slides\", require(\"./routes/slidesRoutes\"));\r\n app.use(\"/api/images\", require(\"./routes/imageRoutes\"));\r\n \r\n-process.on(\"uncaughtException\", (err) => {\r\n-  console.error(\"Uncaught Exception:\", err);\r\n-});\r\n \r\n-process.on(\"unhandledRejection\", (err) => {\r\n-  console.error(\"Unhandled Rejection:\", err);\r\n-});\r\n-\r\n-\r\n // Khởi động server\r\n const PORT = process.env.PORT || 5000;\r\n app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                },
                {
                    "date": 1739007620585,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,8 @@\n app.use(\"/uploads\", express.static(\"uploads\"));\r\n app.use(\"/api/products\", require(\"./routes/productRoutes\"));\r\n app.use(\"/api/users\", require(\"./routes/userRoutes\"));\r\n app.use(\"/api/orders\", require(\"./routes/orderRoutes\"));\r\n-app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));\r\n app.use(\"/api/brands\", require(\"./routes/brandRoutes\")); \r\n app.use(\"/api/slides\", require(\"./routes/slidesRoutes\"));\r\n app.use(\"/api/images\", require(\"./routes/imageRoutes\"));\r\n"
                },
                {
                    "date": 1739008552645,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,8 +21,9 @@\n app.use(\"/api/orders\", require(\"./routes/orderRoutes\"));\r\n app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));\r\n app.use(\"/api/brands\", require(\"./routes/brandRoutes\")); \r\n app.use(\"/api/slides\", require(\"./routes/slidesRoutes\"));\r\n+app.use(\"/api/reviews\", require(\"./routes/reviewsRoutes\"));\r\n app.use(\"/api/images\", require(\"./routes/imageRoutes\"));\r\n \r\n \r\n // Khởi động server\r\n"
                },
                {
                    "date": 1739008582277,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,9 +21,9 @@\n app.use(\"/api/orders\", require(\"./routes/orderRoutes\"));\r\n app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));\r\n app.use(\"/api/brands\", require(\"./routes/brandRoutes\")); \r\n app.use(\"/api/slides\", require(\"./routes/slidesRoutes\"));\r\n-app.use(\"/api/reviews\", require(\"./routes/reviewsRoutes\"));\r\n+app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n app.use(\"/api/images\", require(\"./routes/imageRoutes\"));\r\n \r\n \r\n // Khởi động server\r\n"
                },
                {
                    "date": 1739444111641,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,9 +20,8 @@\n app.use(\"/api/users\", require(\"./routes/userRoutes\"));\r\n app.use(\"/api/orders\", require(\"./routes/orderRoutes\"));\r\n app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));\r\n app.use(\"/api/brands\", require(\"./routes/brandRoutes\")); \r\n-app.use(\"/api/slides\", require(\"./routes/slidesRoutes\"));\r\n app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n app.use(\"/api/images\", require(\"./routes/imageRoutes\"));\r\n \r\n \r\n"
                },
                {
                    "date": 1739949499591,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,11 @@\n app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));\r\n app.use(\"/api/brands\", require(\"./routes/brandRoutes\")); \r\n app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n app.use(\"/api/images\", require(\"./routes/imageRoutes\"));\r\n+app.use(cors());\r\n+app.use(express.json()); // Đọc JSON từ request body\r\n+app.use(express.urlencoded({ extended: true })); // Xử lý form-urlencoded\r\n \r\n-\r\n // Khởi động server\r\n const PORT = process.env.PORT || 5000;\r\n app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                },
                {
                    "date": 1741337157998,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,30 +3,41 @@\n const cors = require(\"cors\");\r\n require(\"dotenv\").config();\r\n \r\n const app = express();\r\n-app.use(cors());\r\n+\r\n+// Middleware CORS - Cho phép cả frontend chạy ở 3000 và 8081\r\n+const allowedOrigins = [\"http://localhost:8081\", \"http://localhost:3000\"];\r\n+app.use(cors({\r\n+  origin: function (origin, callback) {\r\n+    if (!origin || allowedOrigins.includes(origin)) {\r\n+      callback(null, true);\r\n+    } else {\r\n+      callback(new Error(\"Not allowed by CORS\"));\r\n+    }\r\n+  },\r\n+  methods: [\"GET\", \"POST\", \"PUT\", \"DELETE\"],\r\n+  allowedHeaders: [\"Content-Type\", \"Authorization\"],\r\n+  credentials: true,\r\n+}));\r\n+\r\n app.use(express.json());\r\n+app.use(express.urlencoded({ extended: true }));\r\n \r\n // Kết nối MongoDB\r\n-mongoose.connect(process.env.MONGO_URI, {\r\n-  useNewUrlParser: true,\r\n-  useUnifiedTopology: true,\r\n-}).then(() => console.log(\"MongoDB connected\"))\r\n-  .catch(err => console.error(err));\r\n+mongoose.connect(process.env.MONGO_URI)\r\n+  .then(() => console.log(\"MongoDB connected\"))\r\n+  .catch(err => console.error(\"MongoDB connection error:\", err));\r\n \r\n // Routes\r\n app.use(\"/uploads\", express.static(\"uploads\"));\r\n app.use(\"/api/products\", require(\"./routes/productRoutes\"));\r\n app.use(\"/api/users\", require(\"./routes/userRoutes\"));\r\n app.use(\"/api/orders\", require(\"./routes/orderRoutes\"));\r\n app.use(\"/api/categories\", require(\"./routes/categoryRoutes\"));\r\n-app.use(\"/api/brands\", require(\"./routes/brandRoutes\")); \r\n+app.use(\"/api/brands\", require(\"./routes/brandRoutes\"));\r\n app.use(\"/api/reviews\", require(\"./routes/reviewRoutes\"));\r\n app.use(\"/api/images\", require(\"./routes/imageRoutes\"));\r\n-app.use(cors());\r\n-app.use(express.json()); // Đọc JSON từ request body\r\n-app.use(express.urlencoded({ extended: true })); // Xử lý form-urlencoded\r\n \r\n // Khởi động server\r\n const PORT = process.env.PORT || 5000;\r\n app.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
                }
            ],
            "date": 1738055979415,
            "name": "Commit-0",
            "content": "const express = require(\"express\");\r\nconst mongoose = require(\"mongoose\");\r\nconst cors = require(\"cors\");\r\nrequire(\"dotenv\").config();\r\n\r\nconst app = express();\r\napp.use(cors());\r\napp.use(express.json());\r\n\r\n// MongoDB Connection\r\nmongoose.connect(process.env.MONGO_URI, {\r\n  useNewUrlParser: true,\r\n  useUnifiedTopology: true,\r\n}).then(() => console.log(\"MongoDB connected\"))\r\n  .catch(err => console.error(err));\r\n\r\n// Routes\r\napp.use(\"/api/products\", require(\"./routes/productRoutes\"));\r\n\r\nconst PORT = process.env.PORT || 5000;\r\napp.listen(PORT, () => console.log(`Server running on port ${PORT}`));\r\n"
        }
    ]
}